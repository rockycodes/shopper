language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '9.6' # highest available postgres version on Travis
dist: trusty # uses trusty environment
sudo: false # when on trusty, uses Docker containers for speed
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm i -g npm@5.7.1 # delete once 5.7.X is out of "pre-release"
  - npm ci             # faster, goes only from package-lock
before_script:
  - psql -c 'create database "cures-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)

before_deploy:
  - npm run build-client # make the bundle
  - rm -rf node_modules # omit from the tarball, since we skip cleanup
deploy:
  skip_cleanup: true # prevents travis from deleting the build
  provider: heroku
  app: cures-for-what-ails-you # see README
  api_key:
    secure: "ls7kvjH5WB6KwZ2e33uiD2nxYZZ5w5cfPw7QkY1djMMFCOJPW+WG8ktlyrAfpkQWbelL9Ac3cbD/RfoGCG1yAQ4v8D7oM3t/Wa2tpYMAwj6CM5E7WtTLAcPLDI7+h0hnLjJuvzfk6Z/ysonjgnzrg6/W26ZpgXknMJgXv5Zj4T1gUt1EOlo9lxwVAPPVHSNhV+F6Nub+oZX9d1ww7OQozod2sU5WYYe3XqxDOcFatcSFwDhdUejc59tBVF7PhExjWJJYUbzz78JZ9vrsS6amUnqLw/bwdXPgghKns5/VWjBiwDtn5Ae1UkIVgPBeUBortrpE6PVjC8t+kWOeZXh9QZH3kC2LBv4YfXux1AnhTwoK3xZTe9uSaWh/3qTeyx1xC/zCST1wyuubLqJuQGl5AYqaxhHFTCb5w8RMpCVhmmeVFWj+JcvH8TjccgPxQ2gYAmBUTsq8g4659hrpg5AMPh7XPe1kID7RpWnSg4EFpGD2pSkEnwpAqp1PJxbDNPGpb6MPAw/D7jHJtHVTfLSIA0pbiPmYiywPP8Hl1XQHT2eylPmRhXbsSQ3K5Isjd8nWNta7hegB6RrEpGxXFo3XHIcNL9mZlJAdQT1iXorS1klrgyngHcBWlk+9rxcewnAtn4teRPVtC2UpoaQZf7JX6PMKWMd5HLx84ZE62Dcp4to=" # see README
